# 設計文件

## 概述

改進現有的 `check_dependencies()` 和 `load_config()` 函數，提供更清晰的錯誤訊息和恢復指引。

## 設計原則

- 最小改動：只修改現有函數，不重構整體架構
- 實用優先：專注於使用者最常遇到的問題
- 保持簡單：避免過度設計

## 改進方案

### 1. 依賴項檢查改進

**現況：**
- 已有 `check_dependencies()` 函數（第 218-240 行）
- 已經顯示缺失工具和安裝指令

**改進點：**
- 簡化輸出格式（移除不必要的裝飾）
- 只顯示當前平台的安裝指令

**實作位置：**
```bash
# sync-commands-integrated.sh: 218-240
check_dependencies() {
    # 改進此函數
}
```

### 2. 配置檔案驗證改進

**現況：**
- 已有 `load_config()` 函數（第 570-615 行）
- 已檢查檔案存在性和 JSON 語法

**改進點：**
- 簡化錯誤訊息（移除過多的建議步驟）
- 只保留最關鍵的修復指引

**實作位置：**
```bash
# sync-commands-integrated.sh: 570-615
load_config() {
    # 改進此函數
}
```

## 錯誤訊息設計

### 依賴項缺失

```
✗ 缺少必要工具: jq git

安裝方式：
  brew install jq git
```

### 配置檔案錯誤

**檔案不存在：**
```
✗ 配置檔案不存在

請執行: ./sync-commands-integrated.sh init
```

**JSON 語法錯誤：**
```
✗ 配置檔案 JSON 語法錯誤

檢查檔案: cat .speckit-sync.json
驗證語法: jq . .speckit-sync.json
```

## 測試策略

手動測試以下場景：
1. 缺少 jq 工具時執行腳本
2. 配置檔案不存在時執行 check 命令
3. 配置檔案 JSON 語法錯誤時執行 update 命令

## 不做的事

- ❌ 不添加新的驗證函數
- ❌ 不重構現有架構
- ❌ 不添加自動修復功能
- ❌ 不添加詳細的除錯模式
